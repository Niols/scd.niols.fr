---

$schema: https://json-schema.org/draft/2020-12/schema

$id: dance
title: Dance

description: |
  A dance with its metadata and its full description.

type: object

required:
  - name
  - author
  - kind
  - short-kind

properties:

  name:
    type: string
    description: |
      The name of the dance.
    examples:
      - "La Ville Lumière"

  author:
    type: string
    description: |
      The deviser of the dance, as a string.
    examples:
      - "Aymeric Fromherz"

  short-author:
    type: string
    description: |
      A short version of the deviser of the dance, as a string. For instance,
      for a dance whose author is “Anne Lanvin, Corentin Lefèvre, Isabelle
      Herlant, Louise Baltera, Nicolas “Niols” Jeannerod & Victor Lanvin”, the
      short author would be “Anne Lanvin et al.”
    examples:
      - "Anne Lanvin et al."

  scddb-id:
    type: integer
    description: |
      The ID of the dance in the SCDDB, if it exists. This is the last integer
      in the SCDDB URL. For example, if the URL is
      https://my.strathspey.org/dd/dance/20315/, then the ID is 20315.
    examples:
      - 20315

  kind:
    type: string
    description: |
      The kind of the dance as a full English sentence.
    examples:
      - "32-bar reel for four couples in a four-couple longwise set"

  short-kind:
    type: string
    description: |
      The kind of the dance as a compact representation. For example, the
      compact representation of “32-bar reel for four couples in a four-couple
      longwise set” is “R32 4/4L”.
    examples:
      - "R32 4/4L"

  date:
    type: string
    description: |
      The date of composition of the tune, containing at least the year.
    examples:
      - "2020"
      - "2021-08"
      - "2019-03-02"

  date-format:
    type: string
    description: |
      A string describing when the tune was composed. The string may contain the
      special sequences %year% or %at-date%. For instance, if the "date" field
      is "2019-03-02", %year% will be "2019" and %at-date% will be "on 2 March
      2019". If this field is not defined, then %at-date% is used.
    examples:
      - "%at-date%"
      - "during Summer School %year%"
      - "for X's anniversary %at-date%"

  editor-details:
    type: string
    description: |
      Additional details given by the editor. Those should be factual. For
      first-person, personal details given by the deviser, see field
      deviser-details".
    examples:
      - "This dance celebrates [...]."
      - "This dance was initially written [...]"

  deviser-details:
    type: string
    description: |
      Additional details given by the deviser. They will be presented as a
      direct quote and should be written using first-person.
    examples:
      - "I wrote this dance for the [...]"

  tunes:
    type: array
    description: |
      A list of tunes. This propertie is currently unused. <-- FIXME

  description:
    $ref: "#/$defs/description"

additionalProperties: false

$defs:

  description:
    title: Toplevel Dance Description
    description: |
      A dance description, that is a non-empty array of dance description items
      of various types.
    type: array
    minItems: 1
    items:
      $ref: "#/$defs/all-but-text"

  text:
    title: "Dance Description Item: Text"
    description: A dance description text item.
    type: object
    required:
      - type
      - content
    properties:
      type:
        enum: [text]
      content:
        type: string
        description: |
          A string to be included as-is in the output, modulo some escaping for
          HTML entities or TeX special characters.
    additionalProperties: false
    examples:
      - type: text
        content: |
          1st and 4th couple dance a poussette to finish in the order 2, 4, 1, 3.

  all-but-text:
    oneOf:
      - $ref: "#/$defs/note"
      - $ref: "#/$defs/instruction"
      - $ref: "#/$defs/phrase"
      - $ref: "#/$defs/repeat"
      - $ref: "#/$defs/devised-by"
      - $ref: "#/$defs/music-by"
      - $ref: "#/$defs/recommended-tune"

  note:
    title: "Dance Description Item: Note"
    description: A dance description note item.
    type: object
    required:
      - type
      - content
    properties:
      type:
        enum: [note]
      content:
        type: string
        description: |
          A string to be included as a note in the output, modulo some escaping
          for HTML entities or TeX special characters.
    additionalProperties: false
    examples:
      - type: note
        content: |
          Remember the person that is at the left of your partner from your
          point of view: First, third and fifth times, you will start dancing
          with your partner on your original lines; Second, fourth and sixth
          times, you will start dancing with that other person on the opposite
          lines.

  instruction:
    title: "Dance Description Item: Instruction"
    description: A dance description instruction item.
    type: object
    required:
      - type
      - content
    properties:
      type:
        enum: [instruction]
      content:
        type: string
        description: |
          A string to be included as an instruction in the output, modulo some
          escaping for HTML entities or TeX special characters.
    additionalProperties: false
    examples:
      - type: instruction
        content: Strathspey
      - type: instruction
        content: |
          On second chord, 2nd and 3rd couples cross.

  phrase:
    title: "Dance Description Item: Phrase"
    description: A dance description phrase item.
    type: object
    required:
      - type
      - starts
      - ends
      - contents
    properties:
      type:
        enum: [phrase]
      starts:
        type: integer
        description: |
          An integer representing the starting bar of the phrase.
      ends:
        type: integer
        description: |
          An integer representing the ending bar of the phrase.
      contents:
        type: array
        minItems: 1
        items:
          oneOf:
            - $ref: "#/$defs/all-but-text"
            - $ref: "#/$defs/text"
    additionalProperties: false
    examples:
      - type: phrase
        starts: 1
        ends: 4
        contents:
          - type: text
            content: |
              1st couple set and cast off one place as 4th couple set and cast
              up one place. 2nd couple step up and 3rd couple step down on bars
              3-4.

  repeat:
    title: "Dance Description Item: Repeat"
    description: A dance description repeat item.
    type: object
    required:
      - type
      - kind
    properties:
      type:
        enum: [repeat]
      kind:
        enum:
          - from new positions
          - having passed a couple
          - custom
        description: |
          The kind of repeat for this dance.
      text:
        type: string
        description: |
          The custom text for the repeat. FIXME: Only if kind=custom, but then
          it is required.
    additionalProperties: false
    examples:
      - type: repeat
        kind: having passed a couple
      - type: repeat
        kind: custom
        text: Repeat, but only if you want to.

  devised-by:
    title: "Dance Description Item: Devised By"
    description: A dance description devised by item.
    type: object
    required:
      - type
    properties:
      type:
        enum: ["devised by"]
    additionalProperties: false
    examples:
      - type: devised by

  music-by:
    title: "Dance Description Item: Music By"
    description: A dance description music by item.
    type: object
    required:
      - type
      - composer
    properties:
      type:
        enum: ["music by"]
      composer:
        type: string
        description: |
          The composer of the tune.
      tune:
        type: string
        description: |
          The name of the tune.
      more:
        type: string
        description: |
          A string to be added after the name of the composer or the name of the
          tune. It should start with a capital letter.
    additionalProperties: false
    examples:
      - type: music by
        composer: Pascaline Latour
      - type: music by
        composer: Anne Lanvin
        tune: The Sober Piper
        more: |
          Alternatively, one can use one of the tunes for “The Reel of the 51st
          Division”: “The Drunken Piper”, by Alex McLeod.

  recommended-tune:
    title: "Dance Description Item: Recommended Tune"
    description: A dance description recommended tune item.
    type: object
    required:
      - type
      - tune
    properties:
      type:
        enum: ["recommended tune"]
      composer:
        type: string
        description: |
          The composer of the tune.
      tune:
        type: string
        description: |
          The name of the tune.
      more:
        type: string
        description: |
          A string to be added after the name of the composer or the name of the
          tune. It should start with a capital letter.
    additionalProperties: false
    examples:
      - type: recommended tune
        tune: La Ville Lumière
        composer: Pascaline Latour
      - type: recommended tune
        tune: The Sober Piper
        more: |
          Alternatively, one can use one of the tunes for “The Reel of the 51st
          Division”: “The Drunken Piper”, by Alex McLeod.
